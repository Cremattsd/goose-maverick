<!DOCTYPE html>
<html>
<head>
    <title>Goose-Maverick Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center text-blue-600">Goose-Maverick Chatbot</h1>
        <div class="mt-4">
            <input id="message" type="text" class="p-2 border rounded w-full" placeholder="Ask Maverick...">
            <div class="flex space-x-2 mt-2">
                <button onclick="sendMessage()" class="p-2 bg-blue-600 text-white rounded">Send</button>
                <button onclick="startVoice()" class="p-2 bg-green-600 text-white rounded">ğŸ™ï¸ Voice</button>
                <a href="/settings" class="p-2 bg-gray-600 text-white rounded text-center">âš™ï¸ Settings</a>
            </div>
        </div>
        <div id="response" class="mt-4 p-4 bg-white rounded shadow"></div>
        <div id="error" class="hidden fixed top-4 right-4 p-4 bg-red-500 text-white rounded-lg shadow-lg animate-bounce"></div>
    </div>
    <script>
    async function fetchWithErrorHandling(url, options) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                showError(response.status === 404 ? `Whoops, ${url} is off the radar! Try another route, Goose! ğŸ˜` : `Turbulence: ${response.statusText}`);
                return null;
            }
            return await response.json();
        } catch (error) {
            showError(`Mayday! ${error.message}`);
            return null;
        }
    }

    function showError(message) {
        const errorDiv = document.getElementById('error');
        errorDiv.textContent = message;
        errorDiv.classList.remove('hidden');
        setTimeout(() => errorDiv.classList.add('hidden'), 5000);
    }

    async function sendMessage() {
        const message = document.getElementById('message').value;
        const token = localStorage.getItem('token');
        const response = await fetchWithErrorHandling('/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
            body: JSON.stringify({ message })
        });
        if (response) {
            document.getElementById('response').textContent = response.answer;
        }
    }

    function startVoice() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.onresult = async (event) => {
            const transcription = event.results[0][0].transcript;
            const token = localStorage.getItem('token');
            const response = await fetchWithErrorHandling('/transcribe', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                body: JSON.stringify({ transcription })
            });
            if (response) {
                document.getElementById('response').textContent = response.answer;
            }
        };
        recognition.onerror = (event) => showError(`Voice error: ${event.error}`);
        recognition.start();
    }
    </script>
    <style>
    .animate-bounce {
        animation: bounce 0.5s ease infinite;
    }
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    </style>
</body>
</html>
